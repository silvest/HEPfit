<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <link rel="apple-touch-icon" sizes="180x180" href="../../../../images/favicon/apple-touch-icon.png">
 <link rel="icon" type="image/png" sizes="32x32" href="../../../../images/favicon/favicon-32x32.png">
 <link rel="icon" type="image/png" sizes="16x16" href="../../../../images/favicon/favicon-16x16.png">
 <link rel="mask-icon" href="safari-pinned-tab.svg" color="#3b6f74">
 <meta name="msapplication-TileColor" content="#3b6f74">
 <meta name="theme-color" content="#3b6f74">
 <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
 <meta http-equiv="X-UA-Compatible" content="IE=9"/>
 <meta name="generator" content="Doxygen 1.9.2"/>
 <meta name="viewport" content="width=device-width, initial-scale=1"/>
 <title>HEPfit: Usage</title>
 <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
 <script type="text/javascript" src="../../jquery.js"></script>
 <script type="text/javascript" src="../../dynsections.js"></script>
 <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
 <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
 <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
 <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
 <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
 <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
                           extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
                           jax: ["input/TeX","output/HTML-CSS"],
                           tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
                           messageStyle: "none"
                           });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
 <div id="titlearea">
  <table cellspacing="0" cellpadding="5px" width="100%">
   <tbody>
   <tr style="vertical-align: bottom">
    <td id="projectlogo"><a href="https://hepfit.roma1.infn.it/"><img style="height: 80px; margin-bottom: -3px; margin-top: -17px" alt="Logo" src="../../HEPfit-logo-Doxygen.png"/></a>
     <span style="font-size: 36px; font-family: monospace; color: #3b6f74; letter-spacing: 1px" id="projectnumber"> master</span>
    </td>
    <td style="text-align: center;padding-left: 15px">
     <span style="font-size: 22px; font-family: monospace; color: #3b6f74; letter-spacing: 1px; font-weight: bold" id="projectnumber"> a Code for the Combination of Indirect and Direct Constraints on High Energy Physics Models</span>
    </td>
    <td>
     <img style="height: 95px; margin-bottom: -3px; margin-top: -20px; padding-right: 5px;" alt="Logo" src="../../collision.png"/>
    </td>
<!--    <td id="projectalign">-->
<!--     <div id="projectname">-->
<!--      HEPfit-->
      &#160;
<!--      <span style="font-size: 32px; font-family: monospace; float: left" id="projectnumber">master</span>-->
<!--     </div>-->
<!--     <div id="projectbrief">A Code for the Combination of Indirect and Direct Constraints on High Energy Physics Models.</div>-->
<!--    </td>-->
   </tr>
   </tbody>
  </table>
 </div>
 <!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d0/dde/_page_usage.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Usage </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md36">Monte Carlo mode</a><ul><li class="level2"><a href="#autotoc_md37">Step 1: Model configuration file:</a></li>
<li class="level2"><a href="#autotoc_md38">Step 2: Monte Carlo configuration file:</a></li>
<li class="level2"><a href="#autotoc_md39">Step 3: Run:</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md40">Library mode with MCMC</a><ul><li class="level2"><a href="#autotoc_md41">Alternative: Run with MPI.</a></li>
<li class="level2"><a href="#autotoc_md42">Output Files:</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md43">Single event mode</a></li>
<li class="level1"><a href="#autotoc_md44">Even Generation Mode</a><ul><li class="level2"><a href="#autotoc_md45">Output folder structure:</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md46">Library mode without MCMC</a><ul><li class="level2"><a href="#autotoc_md47">Non-Minimal Mode:</a></li>
<li class="level2"><a href="#autotoc_md48">Minimal Mode:</a></li>
<li class="level2"><a href="#autotoc_md49">Use of hepfit-config:</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md50">Custom models and observables</a><ul><li class="level2"><a href="#autotoc_md51">Custom Models:</a></li>
<li class="level2"><a href="#autotoc_md52">Custom Observables</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_Doxygen_Usage"></a></p>
<p >After the <code>HEPfit</code> installer generates the library <code>libHEPFit.a</code> along with header files included in a combined header file, <code>HEPfit.h</code>, the given example implementation can be used to perform a MCMC based Bayesian statistical analysis. Alternatively, the library can be used to obtain predictions of observables for a given point in the parameter space of a model, allowing <code>HEPfit</code> to be called from the user's own program. We explain both methods below. In addition <code>HEPfit</code> provides the ability to the user to define custom models and observables as explained below. We give a brief description on how to get started with custom models and observables.</p>
<h1><a class="anchor" id="autotoc_md36"></a>
Monte Carlo mode</h1>
<p >The Monte Carlo analysis is performed with the <a href="https://www.mppmu.mpg.de/bat/">BAT library</a>. First, a text configuration file containing a list of model parameters, model flags and observables to be analyzed has to be prepared. Another configuration file for the Monte Carlo run has to be prepared, too.</p>
<h2><a class="anchor" id="autotoc_md37"></a>
Step 1: Model configuration file:</h2>
<p >The configuration files are the primary way to control the behaviour of the code and to detail its input and output. While a lot of checks have been implemented in <code>HEPfit</code> to make sure the configuration files are of the right format, it is not possible to make it error-proof. Hence, care should be taken in preparing these files. A configuration file for model parameters, model flags, and observables is written as follows:</p>
<div class="fragment"><div class="line">StandardModel</div>
<div class="line"># Model parameters:</div>
<div class="line">ModelParameter  mtop        173.2       0.9         0.  </div>
<div class="line">ModelParameter  mHl         125.6       0.3         0.  </div>
<div class="line">...</div>
<div class="line">CorrelatedGaussianParameters   V1_lattice 2</div>
<div class="line">ModelParameter  a_0V    0.496   0.067   0.</div>
<div class="line">ModelParameter  a_1V   -2.03    0.92    0.</div>
<div class="line">1.00    0.86</div>
<div class="line">0.86    1.00</div>
<div class="line"> </div>
<div class="line">&lt;All the model parameters have to be listed here&gt;</div>
<div class="line"> </div>
<div class="line"># Observables:</div>
<div class="line">Observable  Mw        Mw        M_{W}      80.3290 80.4064 MCMC weight 80.385 0.015 0.  </div>
<div class="line">Observable  GammaW    GammaW    #Gamma_{W} 2.08569 2.09249 MCMC weight 2.085  0.042 0.  </div>
<div class="line">#</div>
<div class="line"># Correlated observables:</div>
<div class="line">CorrelatedGaussianObservables Zpole2 7  </div>
<div class="line">Observable  Alepton   Alepton   A_{l}      0.143568 0.151850 MCMC weight 0.1513  0.0021  0.  </div>
<div class="line">Observable  Rbottom   Rbottom   R_{b}      0.215602 0.215958 MCMC weight 0.21629 0.00066 0.  </div>
<div class="line">Observable  Rcharm    Rcharm    R_{c}      0.172143 0.172334 MCMC weight 0.1721  0.0030  0.  </div>
<div class="line">Observable  AFBbottom AFBbottom A_{FB}^{b} 0.100604 0.106484 MCMC weight 0.0992  0.0016  0.  </div>
<div class="line">Observable  AFBcharm  AFBcharm  A_{FB}^{c} 0.071750 0.076305 MCMC weight 0.0707  0.0035  0.  </div>
<div class="line">Observable  Abottom   Abottom   A_{b}      0.934320 0.935007 MCMC weight 0.923   0.020   0.  </div>
<div class="line">Observable  Acharm    Acharm    A_{c}      0.666374 0.670015 MCMC weight 0.670   0.027   0.  </div>
<div class="line">1.00   0.00   0.00   0.00   0.00   0.09   0.05</div>
<div class="line">0.00   1.00  -0.18  -0.10   0.07  -0.08   0.04</div>
<div class="line">0.00  -0.18   1.00   0.04  -0.06   0.04  -0.06</div>
<div class="line">0.00  -0.10   0.04   1.00   0.15   0.06   0.01</div>
<div class="line">0.00   0.07  -0.06   0.15   1.00  -0.02   0.04</div>
<div class="line">0.09  -0.08   0.04   0.06  -0.02   1.00   0.11</div>
<div class="line">0.05   0.04  -0.06   0.01   0.04   0.11   1.00  </div>
<div class="line">#</div>
<div class="line"># Output correlations: </div>
<div class="line">Observable2D  MwvsGammaW Mw M_{W} 80.3290 80.4064 noMCMC noweight GammaW #Gamma_{W} 2.08569 2.09249  </div>
<div class="line">...</div>
<div class="line">Observable2D Bd_Bsbar_mumu noMCMC noweight</div>
<div class="line">Observable   BR_Bdmumu      BR(B_{d}#rightarrow#mu#mu)    1. -1.  1.05e-10   0.   0.</div>
<div class="line">Observable   BRbar_Bsmumu   BR(B_{s}#rightarrow#mu#mu)    1. -1.  3.65e-9    0.   0.</div>
<div class="line">...</div>
<div class="line">Observable2D S5_P5 noMCMC noweight</div>
<div class="line">BinnedObservable   S_5      S_5    1. -1.  0.   0.   0.   4.   6.</div>
<div class="line">BinnedObservable   P_5      P_5    1. -1.  0.   0.   0.   4.   6.</div>
<div class="line">#</div>
<div class="line"># Including other configuration files</div>
<div class="line">IncludeFile Flavour.conf</div>
</div><!-- fragment --><p >where the lines beginning with '#' are commented out.</p>
<p >Each line has to be written as follows:</p>
<ol type="1">
<li>The first line must be <b>the name of the model</b> to be analyzed, where the available models are listed in the page <a class="el" href="../../dd/dbf/_page_models.html">Models</a>.<br  />
<br  />
</li>
<li><b><a class="el" href="../../d0/de3/class_model.html" title="A class for the template of models.">Model</a> flags</b>, if necessary, should be specified right after the model because some of them can control the way the input parameters are read. <br  />
 <div class="fragment"><div class="line">ModelFlag &lt;name&gt; &lt;value&gt;</div>
</div><!-- fragment --></li>
<li><b>A model parameter</b> is given in the format: <div class="fragment"><div class="line">%ModelParameter &lt;name&gt; &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt;</div>
</div><!-- fragment --> where all the parameters in a given model (see <a class="el" href="../../dd/dbf/_page_models.html">Models</a>) have to be listed in the configuration file. <br  />
</li>
<li><b>A set of correlated model parameter</b> is specified with "
@code 
    CorrelatedGaussianParameters name Npar
@endcode
   which initializes a set of &lt;tt&gt;Npars&lt;/tt&gt; correlated parameters. It must be
   followed by exactly &lt;tt&gt;Npar&lt;/tt&gt; %Parameter lines and then by &lt;tt&gt;Npar&lt;/tt&gt; lines of
   &lt;tt&gt;Npar&lt;/tt&gt; numbers for the correlation matrix. See the example above.

5. &lt;strong&gt;An observable&lt;/strong&gt; to be computed is specified in one of the following formats:
@code 
    Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC (no)weight &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt;
    Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC file &lt;filename&gt; &lt;histoname&gt;
    Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; noMCMC noweight
    Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; noMCMC writeChain
@endcode

   - &lt;tt&gt;\&lt;name\&gt;&lt;/tt&gt; is a user given name for different observables which must be unique for each observable.
   - &lt;tt&gt;\&lt;obs label\&gt;&lt;/tt&gt; is the theory label of the observable (see the online documentation).
   - &lt;tt&gt;\&lt;histolabel\&gt;&lt;/tt&gt; is used for the label of the output &lt;tt&gt;ROOT&lt;/tt&gt; histogram, while &lt;tt&gt;\&lt;min\&gt;&lt;/tt&gt; and &lt;tt&gt;\&lt;max\&gt;&lt;/tt&gt; represent the
       range of the histogram (if &lt;tt&gt;\&lt;min\&gt;&lt;/tt&gt; &lt;= &lt;tt&gt;\&lt;max\&gt;&lt;/tt&gt; the range of the histogram is set automatically).
   - &lt;tt&gt;(no)MCMC&lt;/tt&gt; is the flag specifying whether the observable should be included in likelihood used for the MCMC sampling.
   - &lt;tt&gt;(no)weight&lt;/tt&gt; specifies if the observable weight will be computed or not. If &lt;tt&gt;weight&lt;/tt&gt; is specified with &lt;tt&gt;noMCMC&lt;/tt&gt;
     then a chain containing the weights for the observable will be stored in the &lt;tt&gt;MCout*.root&lt;/tt&gt; file.  &lt;br&gt;
   - &lt;tt&gt;noMCMC noweight&lt;/tt&gt; is the combination to be used to get a prediction for an observable.
   - When the &lt;tt&gt;weight&lt;/tt&gt; option is specified, at least one of the &lt;tt&gt;\&lt;Gaussian error\&gt;&lt;/tt&gt; or the &lt;tt&gt;\&lt;flat error\&gt;&lt;/tt&gt; must be
     nonvanishing, and the &lt;tt&gt;\&lt;central value\&gt;&lt;/tt&gt; must of course be specified.
   - When using the &lt;tt&gt;file&lt;/tt&gt; option, a histogram in a &lt;tt&gt;ROOT&lt;/tt&gt; file must be specified by the name of the &lt;tt&gt;ROOT&lt;/tt&gt; file 
   (&lt;tt&gt;filename&lt;/tt&gt;) and then the name of the histogram (&lt;tt&gt;histoname&lt;/tt&gt;) in the file (including, if needed, the directory).
   - The &lt;tt&gt;writeChain&lt;/tt&gt; option allows one to write all the values of the observable generated during the main run of the 
        MCMC into the &lt;tt&gt;ROOT&lt;/tt&gt; file.  &lt;br&gt;

6. &lt;strong&gt;A &lt;tt&gt;BinnedObservable&lt;/tt&gt;&lt;/strong&gt; is similar in construction to an &lt;tt&gt;Observable&lt;/tt&gt; but with two extra arguments specifying the 
    upper and lower limit of the bin:
@code 
    BinnedObservable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC (no)weight &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt; &lt;bin_min&gt;       &lt;bin_max&gt;
    BinnedObservable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC (no)weight &lt;filename&gt; &lt;histoname&gt; &lt;bin_min&gt; &lt;bin_max&gt;
    BinnedObservable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; noMCMC writeChain 0. 0. 0. &lt;bin_min&gt; &lt;bin_max&gt;
@endcode
    Because of the order of parsing the &lt;tt&gt;\&lt;central value\&gt; \&lt;Gaussian error\&gt; \&lt;flat error\&gt;&lt;/tt&gt; cannot be dropped out even in the
     &lt;tt&gt;noMCMC noweight&lt;/tt&gt; case for a &lt;tt&gt;BinnedObservable&lt;/tt&gt;.  &lt;br&gt;

7. &lt;strong&gt;A &lt;tt&gt;FunctionObservable&lt;/tt&gt;&lt;/strong&gt; is the same as a &lt;tt&gt;BinnedObservable&lt;/tt&gt; but with only one extra argument that points to the 
    value at which the function is computed:
@code 
    FunctionObservable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC (no)weight &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt; &lt;x_value&gt;
    FunctionObservable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC  (no)weight &lt;filename&gt; &lt;histoname&gt; &lt;x_value&gt;
    FunctionObservable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; noMCMC writeChain 0. 0. 0. &lt;x_value&gt;
@endcode

8. &lt;strong&gt;An asymmetric Gaussian&lt;/strong&gt; constraint can be set using &lt;tt&gt;AsyGausObservable&lt;/tt&gt;:
@code 
    AsyGausObservable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC (no)weight &lt;central value&gt; &lt;left_error&gt; &lt;right_error&gt;
@endcode

9. &lt;strong&gt;Correlations among observables&lt;/strong&gt; can be taken into account with the line &lt;tt&gt;CorrelatedGaussianObservables name Nobs&lt;/tt&gt;,
      which initializes a set of &lt;tt&gt;Nobs&lt;/tt&gt; correlated observables. It must be followed by exactly &lt;tt&gt;Nobs&lt;/tt&gt; &lt;tt&gt;Observable&lt;/tt&gt; lines
       and then by &lt;tt&gt;Nobs&lt;/tt&gt; rows of &lt;tt&gt;Nobs&lt;/tt&gt; numbers for the correlation matrix (see the above example). One can use the 
       keywords &lt;tt&gt;noMCMC&lt;/tt&gt; and &lt;tt&gt;noweight&lt;/tt&gt;, instead of &lt;tt&gt;MCMC&lt;/tt&gt; and &lt;tt&gt;weight&lt;/tt&gt;.  &lt;br&gt;
@code 
    CorrelatedGaussianObservables &lt;name&gt; Nobs
    Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC (no)weight    &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt;
    Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; (no)MCMC (no)weight    &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt;
    ...
    ...
    &lt;Total of Nobs lines of Observables&gt;
    &lt;Nobs x Nobs correlation matrix&gt;
@endcode
   Any construction for &lt;tt&gt;Observable&lt;/tt&gt; mentioned in item 5 of this list above can be used in a &lt;tt&gt;CorrelatedGaussianObservables&lt;/tt&gt; 
   set. Also, &lt;tt&gt;BinnedObservables&lt;/tt&gt; or &lt;tt&gt;FunctionObservables&lt;/tt&gt; can be used instead of and alongside &lt;tt&gt;Observable&lt;/tt&gt;. If 
   &lt;tt&gt;noweight&lt;/tt&gt; is specified for any &lt;tt&gt;Observable&lt;/tt&gt; then that particular &lt;tt&gt;Observable&lt;/tt&gt; along with the corresponding row and 
   column of the correlation matrix is excluded from the set of &lt;tt&gt;CorrelatedGaussianObservables&lt;/tt&gt;.

   In addition, the inverse covariance matrix of a set of &lt;tt&gt;Nobs&lt;/tt&gt; &lt;tt&gt;Observables&lt;/tt&gt; can be specified with the following:  &lt;br&gt;
@code 
    ObservablesWithCovarianceInverse &lt;name&gt; Nobs
    Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; MCMC weight    &lt;central value&gt; 0. 0.
    Observable &lt;name&gt; &lt;obs label&gt; &lt;histolabel&gt; &lt;min&gt; &lt;max&gt; MCMC weight    &lt;central value&gt; 0. 0.
    ...
    ...
    &lt;Total of Nobs lines of Observables&gt;
    &lt;Nobs x Nobs inverse covariance matrix&gt;
@endcode

10. &lt;strong&gt;A correlation between two observables&lt;/strong&gt; can be obtained with: 
@code 
    %Observable2D &lt;name&gt; &lt;obs1 label&gt; &lt;histolabel1&gt; &lt;min1&gt; &lt;max1&gt; noMCMC noweight &lt;obs2 label&gt; &lt;histolabel2&gt; &lt;min2&gt; &lt;max2&gt;
    %Observable2D &lt;name&gt; &lt;obs1 label&gt; &lt;histolabel1&gt; &lt;min1&gt; &lt;max1&gt; MCMC file &lt;filename&gt; &lt;histoname&gt; &lt;obs2 label&gt; &lt;histolabel2&gt; &lt;min2&gt; &lt;max2&gt;
    or
    %Observable2D &lt;name&gt; (no)MCMC (no)weight
    (Binned)%Observable &lt;obs label 1&gt; &lt;histolabel 1&gt; &lt;min&gt; &lt;max&gt; &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt; (&lt;bin_min&gt; &lt;bin_max&gt;)
    (Binned)%Observable &lt;obs label 2&gt; &lt;histolabel 2&gt; &lt;min&gt; &lt;max&gt; &lt;central value&gt; &lt;Gaussian error&gt; &lt;flat error&gt; (&lt;bin_min&gt; &lt;bin_max&gt;)
    %Observable2D &lt;name&gt; MCMC file filename histoname
    (Binned)%Observable &lt;obs label 1&gt; &lt;histolabel 1&gt; &lt;min&gt; &lt;max&gt; (&lt;bin_min&gt; &lt;bin_max&gt;)
    (Binned)%Observable &lt;obs label 2&gt; &lt;histolabel 2&gt; &lt;min&gt; &lt;max&gt; (&lt;bin_min&gt; &lt;bin_max&gt;)
@endcode

9. &lt;strong&gt;Include configuration files&lt;/strong&gt; with the &lt;tt&gt;IncludeFile&lt;/tt&gt; directive. This is useful if one
   wants to separate the input configurations for better organization and flexibility.


@subsection autotoc_md38 Step 2: Monte Carlo configuration file:

The parameters and options of the Monte Carlo run are specified in a configuration file, separate from the one(s) for 
the model. Each line in the file has a pair of a label and its value, separated by space(s) or tab(s). The available
parameters and options are: 

* &lt;tt&gt;NChains&lt;/tt&gt;: The number of chains in the Monte Carlo run. A minimum of 5 is suggested (default). If the theory space is 
    complicated and/or the number of parameters is large then more chains are necessary. The amount of statistics 
    collected in the main run is proportional to the number of chains.

* &lt;tt&gt;PrerunMaxIter&lt;/tt&gt;: The maximum number of iterations that the prerun will go through (Default: 1000000). The prerun ends 
    automatically when the chains converge (by default R$&lt;$1.1, see below) and all efficiencies are adjusted. While it 
    is not necessary for the prerun to converge for a run to be completed, one should exercise caution if convergence 
    is not attained.

* &lt;tt&gt;NIterationsUpdateMax&lt;/tt&gt;: The maximum number of iterations after which the proposal functions are updated in the
    pre-run and convergence is checked. (Default: 1000)

* &lt;tt&gt;Seed&lt;/tt&gt;: The seed can be fixed for deterministic runs. (Default: 0, corresponding to a random seed initialization)

* &lt;tt&gt;Iterations&lt;/tt&gt;: The number of iterations in the main run. This run is for the purpose of collecting statistics and is 
    at the users discretion. (Default: 100000)

* &lt;tt&gt;MinimumEfficiency&lt;/tt&gt;: This allows setting the minimum efficiency of all the parameters to be attained in the prerun. 
    (Default: 0.15)

* &lt;tt&gt;MaximumEfficiency&lt;/tt&gt;: This allows setting the maximum efficiency of all the parameters to be attained in the prerun. 
    (Default: 0.35)

* &lt;tt&gt;RValueForConvergence&lt;/tt&gt;: The $R$-value for which convergence is considered to be attained in the prerun can be set 
    with this flag. (Default: 1.1)

* &lt;tt&gt;WriteParametersChains&lt;/tt&gt;: The chains will be written in the &lt;tt&gt;ROOT&lt;/tt&gt; file MCout*.root. This can be used for analyzing 
    the performance of the chains and/or to use the sampled pdf for postprocessing. (Default: false)

* &lt;tt&gt;FindModeWithMinuit&lt;/tt&gt;: To find the global mode with &lt;tt&gt;MINUIT&lt;/tt&gt; starting from the best fit parameters in the MCMC run. 
    (Default: false)

* &lt;tt&gt;RunMinuitOnly&lt;/tt&gt;: To run a &lt;tt&gt;MINUIT&lt;/tt&gt; minimization only, without running the MCMC. (Default: false)

* &lt;tt&gt;CalculateNormalization&lt;/tt&gt;: Whether the normalization of the posterior pdf will be calculated at the end of the Monte 
    Carlo run. This is useful for model comparison. (Default: false)

* &lt;tt&gt;NIterationNormalizationMC&lt;/tt&gt;: The maximum number of iterations used to compute the normalization. (Default: 1000000)

* &lt;tt&gt;PrintAllMarginalized&lt;/tt&gt;: Whether all marginalized distributions will be printed in a pdf file (MonteCarlo_plots_*.pdf).
    (Default: true)

* &lt;tt&gt;PrintCorrelationMatrix&lt;/tt&gt;: Whether the parametric correlation will be printed in ParamCorrelations*.pdf and ParamCorrelations*.tex. 
    (Default: false)

* &lt;tt&gt;PrintKnowledgeUpdatePlots&lt;/tt&gt;: Whether comparison between prior and posterior knowledge will be printed in a plot stored
    in ParamUpdate*.pdf. (Default: false)

* &lt;tt&gt;PrintParameterPlot&lt;/tt&gt;: Whether a summary of the parameters will be printed in ParamSummary*.pdf. (Default: false)

* &lt;tt&gt;PrintTrianglePlot&lt;/tt&gt;: Whether a triangle plot of the parameters will be printed. (Default: false)

* &lt;tt&gt;WritePreRunData&lt;/tt&gt;: Whether the prerun data is written to a file. Useful to exploit a successful prerun for multiple runs. 
    (Default: false)

* &lt;tt&gt;ReadPreRunData&lt;/tt&gt;: Whether the prerun data will be read from a previously stored prerun file. (Name of the file, default: empty)

* &lt;tt&gt;MultivariateProposal&lt;/tt&gt;: Whether the proposal function will be multivariate or uncorrelated. (Default: true)

* &lt;tt&gt;Histogram1DSmooth&lt;/tt&gt;: Sets the number of iterative smoothing of 1D histograms. (Default: 0)

* &lt;tt&gt;Histogram2DType&lt;/tt&gt;: Sets the type of 2D histograms: 1001 -&gt; Lego (default), 101 -&gt; Filled, 1 -&gt; Contour.

* &lt;tt&gt;MCMCInitialPosition&lt;/tt&gt;: The initial distribution of chains over the parameter space. (Options: Center, RandomPrior, 
    RandomUniform (default))

* &lt;tt&gt;PrintLogo&lt;/tt&gt;: Toggle the printing of the &lt;tt&gt;HEPfit&lt;/tt&gt; logo on the histograms. (Default: true)

* &lt;tt&gt;NoHistogramLegend&lt;/tt&gt;: Toggle the printing of the histogram legend. (Default: false)

* &lt;tt&gt;PrintLoglikelihoodPlots&lt;/tt&gt;: Whether to print the 2D histograms for the parameters vs. loglikelihood. (Default: false)

* &lt;tt&gt;WriteLogLikelihoodChain&lt;/tt&gt;: Whether to write the value of loglikelihood in a chain. (Default: false)

* &lt;tt&gt;Histogram2DAlpha&lt;/tt&gt;: Control the transparency of the 2D histograms. This does not work with all 2D histogram types. 
    (Default: 1)

* &lt;tt&gt;NBinsHistogram1D&lt;/tt&gt;: The number of bins in the 1D histograms. (Default: 100, 0 sets default)

* &lt;tt&gt;NBinsHistogram2D&lt;/tt&gt;: The number of bins in the 2D histograms. (Default: 100, 0 sets default)

* &lt;tt&gt;InitialPositionAttemptLimit&lt;/tt&gt;: The maximum number of attempts made at getting a valid logarithm of the likelihood for 
    all chains before the pre-run starts. (Default: 10000, 0 sets default)

* &lt;tt&gt;SignificantDigits&lt;/tt&gt; The number of significant digits appearing in the Statistics file. (Default: computed based on 
    individual results, 0 sets default)

{\bf \texttt{HistogramBufferSize}}: The memory allocated to each
histogram. Also determines the number of events collected before
setting automatically the histogram range. (Default: 100000)\\

For example, a Monte Carlo configuration file is written as: 

@code 
NChains                    10    
PrerunMaxIter              50000 
Iterations                 10000 
#Seed                       1
PrintAllMarginalized       true  
PrintCorrelationMatrix     true      
PrintKnowledgeUpdatePlots  false 
PrintParameterPlot         false 
MultivariateProposal       true  
@endcode

where a '#' can be placed at the beginning of each line to comment it
out. These are the most commonly used settings. Some less commonly used settings:

@code 
FindModeWithMinuit      (Default: false)
MinimumEfficiency       (Default: 0.15, set to 0. - 1.)
WriteParametersChaina   (Default: false)
CalculateNormalization  (Default: false)
WritePreRunData         (Mandatory: name of file)
ReadPreRunData          (Read existing prerun data file)
@endcode

@subsection autotoc_md39 Step 3: Run:

@section autotoc_md40 Library mode with MCMC 


An example can be found in examples/MonteCarloMode

@code 
  $ cd examples/MonteCarloMode
  $ make
@endcode

After making the configuration files, run with the command:

@code 
  $ analysis &lt;model conf&gt; &lt;Monte Carlo conf&gt;
@endcode

@subsection autotoc_md41 Alternative: Run with MPI.

HEPfit allows for parallel processing of the MCMC run and the observable computations.
To allow for this HEPfit and BAT has to be compiled with MPI support as explained in the
@ref PageInstallation page. The command

@code 
  $ mpiexec -n N analysis &lt;model conf&gt; &lt;Monte Carlo conf&gt;
@endcode

will launch analysis on &lt;tt&gt;N&lt;/tt&gt; thread/cores/processors depending on the smallest
processing unit of the hardware used. Our MPI implementation allows for runs on multi-threaded single processors as
well as clusters with MPI support.

&lt;strong&gt;NOTE:&lt;/strong&gt; Our MPI implementation of HEPfit cannot be used with
BAT compiled with the &lt;tt&gt;--enable-parallelization&lt;/tt&gt; option. It is
mandatory to use the MPI patched version of BAT as explained in the @ref PageInstallation page.


@subsection autotoc_md42 Output Files:

* &lt;tt&gt;log.txt&lt;/tt&gt;: This is the log file.
* &lt;tt&gt;MCout.root&lt;/tt&gt;: This is the root file containing all the information of the run and
  the histogram objects.
* &lt;tt&gt;MonteCarlo_results.txt&lt;/tt&gt;: This file contains the fits to the parameters.
* &lt;tt&gt;MonteCarlo_plots.pdf&lt;/tt&gt;: This File contains the histograms for the parameters.
* &lt;tt&gt;Observables&lt;/tt&gt;: This directory will contain the histograms of all the observables
  specified in the config file.
* &lt;tt&gt;Observables/HistoLog.txt&lt;/tt&gt;: This file contains the information on over-run and under-run
  of the histogram filling.
* &lt;tt&gt;Observables/Statistics.txt&lt;/tt&gt;: This file contains the compilation of the statistics
  extracted from the histograms.

Other files might be generated depending on the options specified in the Monte Carlo 
configuration file.


@section autotoc_md43 Single event mode


Using the model configuration file used in the Monte Carlo mode, one
can obtain predictions of observabes for the central values of the
model parameters with the command: 

@code 
  $ analysis &lt;model conf&gt; --noMC
@endcode

where the results are printed on the standard output. 

@section autotoc_md44 Even Generation Mode


Using the model configuration file used in the Monte Carlo mode, one can obtain predictions of observables. 
An example can be found in &lt;tt&gt;examples/EventGeneration&lt;/tt&gt; folder:

@code 
  $ cd examples/EventGeneration
  $ make
@endcode

After making the configuration files, run with the command:
@code 
  $ ./analysis &lt;model conf&gt; &lt;number of iterations&gt; [output folder]
@endcode

The &lt;tt&gt;\&lt;number of iterations\&gt;&lt;/tt&gt; defines the number of random points in the parameter space that will be evaluated. Setting 
this to 0 gives the value of the observables at the central value of all the parameters. If the &lt;tt&gt;[output folder]&lt;/tt&gt; is not
 specified everything is printed on the screen and no data is saved. Alternately, one can specify the output folder and 
 the run will be saved if &lt;tt&gt;\&lt;number of iterations\&gt;&lt;/tt&gt; &gt; 0. The output folder can be found in &lt;tt&gt;./GeneratedEvents&lt;/tt&gt;. The 
 structure of the output folder is as follows.


@subsection autotoc_md45 Output folder structure:
* &lt;tt&gt;CGO: Contains any correlated Gaussian observables that might have been listed in the model configuration files.
*&lt;/tt&gt;Observables&lt;tt&gt;: Contains any observables that might have been listed in the model configuration files.
*&lt;/tt&gt;Parameters&lt;tt&gt;: Contains all the parameters that were varied in the model configuration files.
*&lt;/tt&gt;Summary.txt`: Contains a list of the model used, the parameters varied, the observables computed and the number of 
   events generated. This can be used, for example, to access all the files from a third party program.

The parameters and the observables are stored in the respective directories in files that are named after the same. 
For example, the parameter &lt;tt&gt;lambda&lt;/tt&gt; will be saved in the file &lt;tt&gt;lambda.txt&lt;/tt&gt; in the &lt;tt&gt;Parameters&lt;/tt&gt; folder.


@section autotoc_md46 Library mode without MCMC 


The library mode allows for access to all the observables implemented in &lt;tt&gt;HEPfit&lt;/tt&gt;
without a Monte Carlo run. The users can use one of our defined @ref PageModels and vary ModelParameters
according to their own algorithm and get the corresponding predictions for the observables. 

This is made possible through:

* a combined library: libHEPfit.a (installed in &lt;tt&gt;HEPFIT_INSTALL_DIR/lib/&lt;/tt&gt;
* a combined header file: HEPfit.h (installed in &lt;tt&gt;HEPFIT_INSTALL_DIR/include/HEPfit/&lt;/tt&gt;)


The &lt;tt&gt;HEPfit&lt;/tt&gt; library allows for two different implementations of the access algorithm.

@subsection autotoc_md47 Non-Minimal Mode:

In the non-minimal mode the user can use the model configuration file to pass the default value of
the model parameters. The following elements must be present in the user code to define
the parameters and access the observable. (For details of model parameters, observables etc. please lookup @ref PageModels.)

@code{c} 
// Include the necessary header file. 
#include &lt;HEPfit.h&gt;

// Define the model configuration file. 
std::string ModelConf = "SomeModel.conf";

// Define a map for the observables. 
std::map&lt;std::string, double&gt; DObs;

// Define a map for the parameters to be varied.
std::map&lt;std::string, double&gt; DPars;

// Initialize the observables to be returned. 
DObs["<a class="el" href="../../dc/dc7/class_mw.html" title="An observable class for the -boson mass.">Mw</a>"] = 0;
DObs["<a class="el" href="../../df/d87/class_gamma_z.html" title="An observable class for the total decay width of the  boson.">GammaZ</a>"] = 0.;
DObs["<a class="el" href="../../d7/d09/class_a_f_bbottom.html" title="An observable class for the forward-backward asymmetry in  at the  pole.">AFBbottom</a>"] = 0.;

// Create and object of the class ComputeObservables. 
ComputeObservables CO(ModelConf, DObs);

// Vary the parameters that need to be varied in the analysis. 
DPars["Mz"] = 91.1875;
DPars["AlsMz"] = 0.1184;

// Get the map of observables with the parameter values defined above. 
DObs = CO.compute(DPars);

@endcode


@subsection autotoc_md48 Minimal Mode:

In the minimal mode the user can use the default values in InputParameters header file to define the
default values of the model parameters therefore not requiring any additional input files to be
parsed. (For details of model name, flags, parameters, observables etc. please lookup @ref PageModels.)

@code{c} 
// Include the necessary header file. 
#include &lt;HEPfit.h&gt;

// Define a map for the observables. 
std::map&lt;std::string, double&gt; DObs;

// Define a map for the mandatory model parameters used during initializing a model. 
std::map&lt;std::string, double&gt; DPars_IN;

// Define a map for the parameters to be varied. 
std::map&lt;std::string, double&gt; DPars;

// Define a map for the model flags. 
std::map&lt;std::string, std::string&gt; DFlags;

// Define the name of the model to be used. 
std::string ModelName = "<a class="el" href="../../dc/def/class_n_p_zbbbar.html" title="A model class for new physics in the form of contributions to the  couplings.">NPZbbbar</a>";

// Create and object of the class InputParameters. 
InputParameters IP;

// Read a map for the mandatory model parameters. (Default values in InputParameters.h) 
DPars_IN = IP.getInputParameters(ModelName);

// Change the default values of the mandatory model parameters if necessary. 
// This can also be done with Dpars after creating an object of ComputeObservables 
DPars_IN["mcharm"] = 1.3;
DPars_IN["mub"] = 4.2;

// Initialize the observables to be returned. 
DObs["<a class="el" href="../../dc/dc7/class_mw.html" title="An observable class for the -boson mass.">Mw</a>"] = 0;
DObs["<a class="el" href="../../df/d87/class_gamma_z.html" title="An observable class for the total decay width of the  boson.">GammaZ</a>"] = 0.;
DObs["<a class="el" href="../../d7/d09/class_a_f_bbottom.html" title="An observable class for the forward-backward asymmetry in  at the  pole.">AFBbottom</a>"] = 0.;

// Initialize the model flags to be set. 
DFlags["NPZbbbarLR"] = "TRUE";

// Create and object of the class ComputeObservables. 
ComputeObservables CO(ModelName, DPars_IN, DObs);

// Set the flags for the model being used, if necessary. 
CO.setFlags(DFlags);

// Vary the parameters that need to be varied in the analysis. 
DPars["mtop"] = 170.0;
DPars["mHl"] = 126.0;

// Get the map of observables with the parameter values defined above. 
DObs = CO.compute(DPars);
@endcode


@subsection autotoc_md49 Use of hepfit-config:

A hepfit-config script can be found in the &lt;tt&gt;HEPFIT_INSTALL_DIR/bin/&lt;/tt&gt; directory, which can be invoked with the 
following options:

@code 
Library and Library Path: hepfit-config --libs
Include Path: hepfit-config --cflags
@endcode

@section autotoc_md50 Custom models and observables 

A very useful feature of &lt;tt&gt;HEPfit&lt;/tt&gt; is that it allows the user to create custom models and observables. We have already 
provided a template that can be found in the &lt;tt&gt;examples/myModel&lt;/tt&gt; directory which can be used as a starting point. 
Below we describe how to implement both custom models and custom observables.

@subsection autotoc_md51 Custom Models:
The idea of a custom model is to define an additional set of parameters over and above what is defined in any model in
&lt;tt&gt;HEPfi&lt;/tt&gt;. Typically the starting point is the &lt;tt&gt;StandardModel&lt;/tt&gt;, as in the template present in the &lt;tt&gt;HEPfit&lt;/tt&gt; package. 
Going by this template in the &lt;tt&gt;examples/myModel&lt;/tt&gt; directory, to create a model one has to define the following:

* In the &lt;tt&gt;myModel.h&lt;/tt&gt; header file:
   1. Define the number of additional parameters:
@code 
static const int NmyModelvars = 4;
@endcode
   2. Define the variables corresponding to the parameters:
@code 
double c1, c2, c3, c4;
@endcode
   3. Define getters for all the parameters:
@code 
double getc1() const { return c1; }
double getc2() const { return c2; }
double getc3() const { return c3; }
double getc4() const { return c4; }
@endcode

* In the &lt;tt&gt;myModel.cpp&lt;/tt&gt; file:
    1. Define the names of the parameters (they can be different from the variable names):
@code 
const std::string myModel::myModelvars[NmyModelvars] = {"c1", "c2", "c3", "c4"};
@endcode
    2. Link the parameter name to the variable containing it for all the parameters:  &lt;br&gt;
@code 
ModelParamMap.insert(std::make_pair("c1", std::cref(c1)));
ModelParamMap.insert(std::make_pair("c2", std::cref(c2)));
ModelParamMap.insert(std::make_pair("c3", std::cref(c3)));
ModelParamMap.insert(std::make_pair("c4", std::cref(c4)));
@endcode
    3. Link the names of the parameters to the corresponding variables in the \texttt{setParameter} method:  &lt;br&gt;
@code 
        if(name.compare("c1") == 0)
                c1 = value;
            else if(name.compare("c2") == 0)
                c2 = value;
            else if(name.compare("c3") == 0)
                c3 = value;
            else if(name.compare("c4") == 0)
                c4 = value;
            else
                StandardModel::setParameter(name,value);
@endcode

This completes the definition of the model. One can also define flags that will control certain aspects of the model, 
but since this is an advanced and not so commonly used feature we will not describe it here. There is an implementation 
in the template for the user to follow should it be needed. Finally, the custom model needs to be added with a name to 
the &lt;tt&gt;ModelFactory&lt;/tt&gt; in the main function as is done in &lt;tt&gt;examples/myModel/myModel_MCMC.cpp&lt;/tt&gt;.

@code 
ModelF.addModelToFactory("myModel", boost::factory&lt;myModel*&gt;() );
@endcode

@subsection autotoc_md52 Custom Observables

The definition of custom observables does not depend on having defined a custom model or not. A custom observable can be
 any observable that has not been defined in &lt;tt&gt;HEPfit&lt;/tt&gt;. It can be a function of parameters already defined in a &lt;tt&gt;HEPfit&lt;/tt&gt; 
 model or in a custom model or a combination of the two. However, a custom observable has to be explicitly added to the 
 &lt;tt&gt;ThObsFactory&lt;/tt&gt; in the main function as is done in &lt;tt&gt;examples/myModel/myModel_MCMC.cpp&lt;/tt&gt;.
@code 
ThObsF.addObsToFactory("BIN1", boost::bind(boost::factory&lt;yield*&gt;(), _1, 1) );
ThObsF.addObsToFactory("BIN2", boost::bind(boost::factory&lt;yield*&gt;(), _1, 2) );
ThObsF.addObsToFactory("BIN3", boost::bind(boost::factory&lt;yield*&gt;(), _1, 3) );
ThObsF.addObsToFactory("BIN4", boost::bind(boost::factory&lt;yield*&gt;(), _1, 4) );
ThObsF.addObsToFactory("BIN5", boost::bind(boost::factory&lt;yield*&gt;(), _1, 5) );
ThObsF.addObsToFactory("BIN6", boost::bind(boost::factory&lt;yield*&gt;(), _1, 6) );
ThObsF.addObsToFactory("C_3", boost::factory&lt;C_3*&gt;() );
ThObsF.addObsToFactory("C_4", boost::factory&lt;C_4*&gt;() ); </li>
</ol>
<p >The first 6 observables require an argument and hence needed <code>boost::bind</code>. The last two do not need an argument. The implementation of these observables can be found in <code>examples/myModel/src/myObservables.cpp</code> and the corresponding header file. In this template the <code>myObservables</code> class inherits from the <code>THObservable</code> class and the observables called <code>yield</code>, <code>C_3</code> and <code>C_4</code> inherit from the former. Passing an object of the <code><a class="el" href="../../dc/dd5/class_standard_model.html" title="A model class for the Standard Model.">StandardModel</a></code> class as a reference is mandatory as is the overloading of the <code>computeThValue</code> method by the custom observables, which is used to compute the value of the observable at each iteration. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Jan 29 2025 for $\texttt{HEPfit}$ using
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
